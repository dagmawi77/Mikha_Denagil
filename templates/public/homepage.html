{% extends "public/base.html" %}

{% block title %}Home - Mikha Denagil Spiritual Society{% endblock %}

{% block extra_css %}
<style>
    .hero-slider {
        height: 600px;
        position: relative;
        overflow: hidden;
        margin-top: -76px; /* Offset navbar padding */
    }
    .hero-slide {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        z-index: 1;
    }
    .hero-slide.active {
        opacity: 1;
        z-index: 2;
    }
    .hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.6));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        text-align: center;
        padding: 2rem;
    }
    .hero-content h1 {
        font-size: 3.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    .hero-content p {
        font-size: 1.25rem;
        margin-bottom: 2rem;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    .section-padding {
        padding: 5rem 0;
    }
    .service-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        height: 100%;
    }
    .service-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
    }
    .gallery-item {
        position: relative;
        overflow: hidden;
        border-radius: 8px;
        aspect-ratio: 1;
    }
    .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    .gallery-item:hover img {
        transform: scale(1.1);
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Slider Section -->
<section class="hero-slider" id="heroSlider">
    {% if hero_slides and hero_slides|length > 0 %}
        <!-- Debug: {{ hero_slides|length }} slides loaded from server -->
        {% set has_slides_with_images = false %}
        {% for slide in hero_slides %}
            {% if slide.image_path and slide.image_path != '' and slide.image_path != None %}
                {% set has_slides_with_images = true %}
            {% endif %}
        {% endfor %}
        
        {% if has_slides_with_images %}
        {% for slide in hero_slides %}
        {% if slide.image_path and slide.image_path != '' and slide.image_path != None %}
        <div class="hero-slide {% if loop.first %}active{% endif %}" 
             style="background-image: url('{{ url_for('static', filename=slide.image_path) }}');"
             data-bg-fallback="{{ url_for('uploaded_file', filename=slide.image_path) }}"
             data-slide-id="{{ slide.id }}"
             data-image-path="{{ slide.image_path }}">
            <div class="hero-overlay">
                <div class="hero-content">
                    <h1>{{ slide.title_amharic or slide.title or 'Welcome' }}</h1>
                    {% if slide.description or slide.description_amharic %}
                    <p>{{ slide.description_amharic or slide.description }}</p>
                    {% endif %}
                    {% if slide.button_link %}
                    <a href="{{ slide.button_link }}" class="btn btn-light btn-lg">
                        {{ slide.button_text or 'Learn More' }}
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
        {% endfor %}
        {% else %}
        <!-- No slides with images found -->
        <div class="hero-slide active" style="background: linear-gradient(135deg, #14860C 0%, #106b09 100%);">
            <div class="hero-overlay">
                <div class="hero-content">
                    <h1>Mikha Denagil Spiritual Society</h1>
                    <p>ሚካ ደናግል መንፈሳዊ ማህበር</p>
                    <p class="text-warning">No slides with images found. Please check admin panel.</p>
                </div>
            </div>
        </div>
        {% endif %}
    {% else %}
        <!-- Default slide if no slides configured -->
        <div class="hero-slide active" style="background: linear-gradient(135deg, #14860C 0%, #106b09 100%);">
            <div class="hero-overlay">
                <div class="hero-content">
                    <h1>Mikha Denagil Spiritual Society</h1>
                    <p>ሚካ ደናግል መንፈሳዊ ማህበር</p>
                    <a href="{{ url_for('public_website.about_page') }}" class="btn btn-light btn-lg">
                        Learn More / የበለጠ ይወቁ
                    </a>
                </div>
            </div>
        </div>
    {% endif %}
</section>

<!-- About Section -->
<section class="section-padding bg-light">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 mb-4 mb-lg-0">
                {% if about_intro %}
                    <h2 class="display-4 mb-4">{{ about_intro.title_amharic or about_intro.title }}</h2>
                    <p class="lead">{{ about_intro.content_amharic or about_intro.content }}</p>
                {% else %}
                    <h2 class="display-4 mb-4">About Mikha Denagil</h2>
                    <p class="lead">Welcome to Mikha Denagil Spiritual Society, a community dedicated to spiritual growth, fellowship, and service.</p>
                {% endif %}
                <a href="{{ url_for('public_website.about_page') }}" class="btn btn-primary btn-lg mt-3">
                    Read More / የበለጠ ያንብቡ
                </a>
            </div>
            <div class="col-lg-6">
                {% if about_intro and about_intro.image_path %}
                <img src="{{ url_for('static', filename=about_intro.image_path) }}" 
                     alt="About Us" class="img-fluid rounded shadow">
                {% else %}
                <div class="bg-primary text-white p-5 rounded shadow text-center" style="min-height: 300px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-church" style="font-size: 5rem;"></i>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Services Section -->
<section class="section-padding">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="display-4 mb-3">Our Services / አገልግሎቶቻችን</h2>
            <p class="lead text-muted">Spiritual services and activities for all members</p>
        </div>
        <div class="row g-4">
            {% if services %}
                {% for service in services %}
                <div class="col-md-4">
                    <div class="card service-card h-100 shadow-sm">
                        <div class="card-body text-center p-4">
                            {% if service.icon_class %}
                            <i class="{{ service.icon_class }} fa-3x text-primary mb-3"></i>
                            {% elif service.image_path %}
                            <img src="{{ url_for('static', filename=service.image_path) }}" 
                                 alt="{{ service.service_name }}" class="img-fluid mb-3" style="max-height: 80px;">
                            {% else %}
                            <i class="fas fa-hands-praying fa-3x text-primary mb-3"></i>
                            {% endif %}
                            <h4 class="card-title">{{ service.service_name_amharic or service.service_name }}</h4>
                            <p class="card-text text-muted">
                                {{ service.short_description[:100] }}{% if service.short_description|length > 100 %}...{% endif %}
                            </p>
                            <a href="{{ url_for('public_website.service_detail', service_id=service.id) }}" 
                               class="btn btn-outline-primary">
                                Learn More
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="col-12 text-center">
                    <p class="text-muted">Services will be displayed here once configured.</p>
                </div>
            {% endif %}
        </div>
        <div class="text-center mt-5">
            <a href="{{ url_for('public_website.services_page') }}" class="btn btn-primary btn-lg">
                View All Services / ሁሉንም አገልግሎቶች ይመልከቱ
            </a>
        </div>
    </div>
</section>

<!-- Gallery Section -->
<section class="section-padding bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="display-4 mb-3">Photo Gallery / ፎቶ ማውጫ</h2>
            <p class="lead text-muted">Moments from our community</p>
        </div>
        {% if gallery_photos %}
        <div class="gallery-grid">
            {% for photo in gallery_photos[:12] %}
            <div class="gallery-item">
                <img src="{{ url_for('static', filename=photo.image_path) }}" 
                     alt="{{ photo.title_amharic or photo.title or 'Gallery Photo' }}"
                     onclick="openLightbox('{{ url_for('static', filename=photo.image_path) }}', '{{ photo.title_amharic or photo.title }}')">
            </div>
            {% endfor %}
        </div>
        <div class="text-center mt-4">
            <a href="{{ url_for('public_website.gallery_page') }}" class="btn btn-primary btn-lg">
                View Full Gallery / ሙሉ ፎቶ ማውጫ ይመልከቱ
            </a>
        </div>
        {% else %}
        <div class="text-center">
            <p class="text-muted">Gallery photos will be displayed here once uploaded.</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- Donation Section -->
<section class="section-padding bg-primary text-white">
    <div class="container text-center">
        <h2 class="display-4 mb-3">Support Our Mission / ተልዕኮችን ድገዱ</h2>
        <p class="lead mb-4">Your generous donations help us continue our spiritual work and serve the community.</p>
        <a href="{{ url_for('public_website.donation_page') }}" class="btn btn-light btn-lg">
            <i class="fas fa-heart me-2"></i>Donate Now / አሁን ይለግሱ
        </a>
    </div>
</section>

<!-- Announcements Section -->
{% if announcements %}
<section class="section-padding">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="display-4 mb-3">Announcements / ማስታወቂያዎች</h2>
            <p class="lead text-muted">Latest updates and news from our community</p>
        </div>
        <div class="row">
            {% for announcement in announcements %}
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <span class="badge bg-primary mb-2">{{ announcement.post_type }}</span>
                        <h5 class="card-title">
                            <a href="{{ url_for('public_website.announcement_detail', post_id=announcement.id) }}" class="text-decoration-none text-dark">
                                {{ announcement.post_title }}
                            </a>
                        </h5>
                        <p class="card-text text-muted">
                            {{ announcement.post_content[:150]|striptags }}{% if announcement.post_content|length > 150 %}...{% endif %}
                        </p>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                <i class="far fa-calendar me-1"></i>{{ announcement.created_at.strftime('%B %d, %Y') }}
                            </small>
                            <a href="{{ url_for('public_website.announcement_detail', post_id=announcement.id) }}" class="btn btn-sm btn-outline-primary">
                                Read More
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="text-center mt-4">
            <a href="{{ url_for('public_website.announcements_page') }}" class="btn btn-outline-primary btn-lg">
                View All Announcements / ሁሉንም ማስታወቂያዎች ይመልከቱ
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- Studies Section -->
{% if public_studies %}
<section class="section-padding bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="display-4 mb-3">Study Materials / የጥናት ቁሳቁሶች</h2>
            <p class="lead text-muted">Spiritual teachings and resources for your faith journey</p>
        </div>
        <div class="row">
            {% for study in public_studies %}
            <div class="col-md-4 mb-4">
                <div class="card shadow-sm h-100">
                    {% if study.attachment_type == 'image' and study.attachment_path %}
                    <img src="{{ url_for('static', filename=study.attachment_path) }}" class="card-img-top" alt="{{ study.study_title }}" style="height: 200px; object-fit: cover;">
                    {% else %}
                    <div class="card-img-top bg-primary text-white d-flex align-items-center justify-content-center" style="height: 200px;">
                        <i class="fas fa-book fa-3x"></i>
                    </div>
                    {% endif %}
                    <div class="card-body">
                        {% if study.is_featured %}
                        <span class="badge bg-warning text-dark mb-2">Featured</span>
                        {% endif %}
                        {% if study.category_name_amharic %}
                        <span class="badge bg-secondary mb-2">{{ study.category_name_amharic }}</span>
                        {% endif %}
                        <h5 class="card-title">
                            <a href="{{ url_for('public_website.study_detail', study_id=study.id) }}" class="text-decoration-none text-dark">
                                {{ study.study_title }}
                            </a>
                        </h5>
                        {% if study.summary %}
                        <p class="card-text text-muted">
                            {{ study.summary[:100] }}{% if study.summary|length > 100 %}...{% endif %}
                        </p>
                        {% endif %}
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <small class="text-muted">
                                {% if study.author %}
                                <i class="fas fa-user me-1"></i>{{ study.author }}
                                {% endif %}
                                {% if study.publish_date %}
                                <br><i class="far fa-calendar me-1"></i>{{ study.publish_date.strftime('%B %d, %Y') }}
                                {% endif %}
                            </small>
                        </div>
                        <div class="mt-3">
                            <a href="{{ url_for('public_website.study_detail', study_id=study.id) }}" class="btn btn-sm btn-primary w-100">
                                Read More / ይንብቡ
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="text-center mt-4">
            <a href="{{ url_for('public_website.studies_page') }}" class="btn btn-outline-primary btn-lg">
                View All Studies / ሁሉንም ጥናቶች ይመልከቱ
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- Lightbox Modal -->
<div class="modal fade" id="lightboxModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content bg-dark">
            <div class="modal-header border-0">
                <h5 class="modal-title text-white" id="lightboxTitle"></h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <img id="lightboxImage" src="" alt="" class="img-fluid">
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Lightbox function
    function openLightbox(imageSrc, title) {
        document.getElementById('lightboxImage').src = imageSrc;
        document.getElementById('lightboxTitle').textContent = title || '';
        const lightboxModal = new bootstrap.Modal(document.getElementById('lightboxModal'));
        lightboxModal.show();
    }
    
    // Hero slider is initialized by public-website.js
    // Images are loaded and validated by initHeroSlider() function
    // Check browser console for image loading debug information
</script>
{% endblock %}


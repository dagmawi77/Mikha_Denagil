{% extends "base.html" %}

{% block content %}
<style>
    .studies-view-container {
        background: #f8f9fa;
        min-height: 100vh;
        padding: 30px;
    }
    
    .page-header {
        background: linear-gradient(135deg, #14860C 0%, #106b09 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
        box-shadow: 0 5px 15px rgba(20, 134, 12, 0.3);
    }
    
    .page-header h2 {
        margin: 0;
        font-size: 32px;
        font-weight: 700;
    }
    
    .filter-section {
        background: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }
    
    .study-item {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        transition: all 0.3s;
        border-left: 4px solid #14860C;
        cursor: pointer;
    }
    
    .study-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .study-item.featured {
        border-left-color: #ffc107;
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.05) 0%, rgba(255, 255, 255, 1) 50%);
    }
    
    .study-title {
        font-size: 24px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 10px;
    }
    
    .study-meta {
        font-size: 14px;
        color: #6c757d;
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        margin-bottom: 15px;
    }
    
    .study-summary {
        color: #495057;
        line-height: 1.7;
        font-size: 15px;
        margin-bottom: 15px;
    }
    
    .study-badges {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .badge-category {
        background: #17a2b8;
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 13px;
    }
    
    .badge-audience {
        background: #14860C;
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 13px;
    }
    
    .badge-featured {
        background: #ffc107;
        color: #000;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: bold;
    }
    
    .no-studies {
        text-align: center;
        padding: 80px 20px;
        color: #6c757d;
    }
    
    .no-studies i {
        font-size: 100px;
        color: #dee2e6;
        margin-bottom: 20px;
    }
</style>

<div class="studies-view-container">
    <!-- Page Header -->
    <div class="page-header">
        <h2>
            <i class="fa fa-book"></i>
            Study Materials / የትምህርት ጽሁፎች
        </h2>
        <p>Access study materials and teachings / የትምህርት ጽሁፎችንና ትምህርቶችን ያግኙ</p>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <form method="GET" class="row">
            <div class="col-md-6 mb-3">
                <label><i class="fa fa-search"></i> Search / ፍለጋ</label>
                <input type="text" class="form-control" name="search" 
                       placeholder="Search by title, content, or tags..." value="{{ search }}">
            </div>
            <div class="col-md-4 mb-3">
                <label><i class="fa fa-filter"></i> Category / ምድብ</label>
                <select class="form-control" name="category">
                    <option value="">All Categories / ሁሉም ምድቦች</option>
                    {% for cat in categories %}
                    <option value="{{ cat[0] }}" {% if category_filter == cat[0]|string %}selected{% endif %}>
                        {{ cat[1] }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2 mb-3">
                <label>&nbsp;</label>
                <button type="submit" class="btn btn-success btn-block">
                    <i class="fa fa-search"></i> Filter / አጣራ
                </button>
            </div>
        </form>
    </div>

    <!-- Studies List -->
    {% if studies %}
        {% for study in studies %}
        <div class="study-item {% if study[14] == 1 %}featured{% endif %}" 
             onclick="window.location.href='{{ url_for('study_details', study_id=study[0]) }}'">
            
            {% if study[14] == 1 %}
            <div class="mb-2">
                <span class="badge-featured">
                    <i class="fa fa-star"></i> FEATURED / ተለይቶ የቀረበ
                </span>
            </div>
            {% endif %}
            
            <div class="study-title">
                {{ study[1] }}
            </div>
            
            <div class="study-meta">
                <span><i class="fa fa-folder"></i> {{ study[3] }}</span>
                <span><i class="fa fa-users"></i> {{ study[4] }}</span>
                <span><i class="fa fa-user"></i> {{ study[11] }}</span>
                {% if study[10] %}
                <span><i class="fa fa-calendar"></i> {{ study[10] }}</span>
                {% endif %}
                <span><i class="fa fa-eye"></i> {{ study[12] }} views</span>
                {% if study[13] > 0 %}
                <span><i class="fa fa-download"></i> {{ study[13] }} downloads</span>
                {% endif %}
            </div>
            
            {% if study[6] %}
            <div class="study-summary">
                {{ study[6] }}
            </div>
            {% else %}
            <div class="study-summary">
                {{ study[5][:200]|striptags if study[5] else '' }}...
            </div>
            {% endif %}
            
            <div class="study-badges">
                <span class="badge-category">
                    <i class="fa fa-tag"></i> {{ study[3] }}
                </span>
                <span class="badge-audience">
                    <i class="fa fa-users"></i> {{ study[4] }}
                </span>
                {% if study[9] %}
                <span class="badge badge-success">
                    <i class="fa fa-paperclip"></i> Has Attachment
                </span>
                {% endif %}
                {% if study[15] %}
                <span class="badge badge-secondary">
                    <i class="fa fa-tags"></i> {{ study[15] }}
                </span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="no-studies">
            <i class="fa fa-book"></i>
            <h3>No Study Materials Available / ምንም የትምህርት ጽሁፎች የሉም</h3>
            <p>There are currently no study materials available.</p>
            <p>በአሁኑ ጊዜ ምንም የትምህርት ጽሁፎች የሉም።</p>
            <p class="text-muted mt-3">
                <small>Studies will appear here once they are published by administrators.</small>
            </p>
        </div>
    {% endif %}
</div>

<script>
// Auto-dismiss alerts
setTimeout(() => $('.alert').alert('close'), 5000);
</script>

{% endblock %}
